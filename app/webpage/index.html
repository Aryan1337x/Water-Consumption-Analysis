{% extends 'base.html' %}

{% block content %}
<div class="summary-cards">
    <div class="card">
        <h3>Total Consumption</h3>
        <div class="value">{{ stats.total_consumption }} L</div>
    </div>
    <div class="card">
        <h3>Avg Daily Usage</h3>
        <div class="value">{{ stats.avg_daily }} L</div>
    </div>
</div>

<h2>History</h2>
<table>
    <thead>
        <tr>
            <th>Date</th>
            <th>Reading</th>
            <th>Consumption (Liters)</th>
            <th>Category</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for row in history %}
        <tr class="{{ 'spike' if row.is_spike else '' }}">
            <td>{{ row.date.strftime('%Y-%m-%d') }}</td>
            <td>{{ row.reading_value }}</td>
            <td>
                {% if row.consumption is not none %}
                {{ row.consumption }} L
                {% else %}
                -
                {% endif %}
            </td>
            <td>
                {{ row.consumption_category }}
                {% if row.is_spike %}
                <br><strong style="color:red;">(Spike)</strong>
                {% endif %}
            </td>
            <td>
                <form action="{{ url_for('main.delete_reading', id=row.id) }}" method="POST"
                    onsubmit="return confirm('Are you sure? This might affect adjacent calculations.');"
                    style="display:inline;">
                    <button type="submit" class="btn-delete">Delete</button>
                </form>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="5" style="text-align:center;">No readings found. <a
                    href="{{ url_for('main.add_reading') }}">Add one now</a>.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}